<!DOCTYPE html>
<html lang="{{ current_language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if current_language == 'es' %}Clasificador de Literatura Médica{% else %}Medical Literature Classifier{% endif %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --tech-primary: #0056b3;
            --tech-secondary: #00a0e3;
            --tech-accent: #ff6b00;
            --tech-dark: #1a1a1a;
            --tech-light: #f8f9fa;
        }
        
        body {
            padding-top: 2rem;
            background-color: var(--tech-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--tech-dark);
        }
        
        .card {
            margin-bottom: 1.5rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--tech-primary), var(--tech-secondary));
            border: none;
            padding: 1.25rem;
        }
        
        .result-card {
            display: none;
        }
        
        .category-badge {
            font-size: 1rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: var(--tech-accent) !important;
            padding: 0.5rem 1rem;
            border-radius: 30px;
        }
        
        .form-control, .form-select {
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #ced4da;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--tech-secondary);
            box-shadow: 0 0 0 0.25rem rgba(0, 160, 227, 0.25);
        }
        
        .btn-primary {
            background-color: var(--tech-primary);
            border-color: var(--tech-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--tech-secondary);
            border-color: var(--tech-secondary);
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        .progress-bar {
            background-color: var(--tech-accent);
        }
        
        .language-selector {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }
        
        .language-btn {
            margin-left: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            text-decoration: none;
        }
        
        .language-btn.active {
            font-weight: bold;
            background-color: var(--tech-primary);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            {% for code, name in languages.items() %}
                <a href="{{ url_for('set_language', language=code) }}" class="language-btn {% if current_language == code %}active{% endif %}">{{ name }}</a>
            {% endfor %}
        </div>
        
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header text-white">
                        <h2 class="mb-0">
                            {% if current_language == 'es' %}
                                Clasificador de Literatura Médica
                            {% else %}
                                Medical Literature Classifier
                            {% endif %}
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="modelSelect" class="form-label">
                                {% if current_language == 'es' %}
                                    Seleccionar Modelo
                                {% else %}
                                    Select Model
                                {% endif %}
                            </label>
                            <div class="input-group">
                                <select class="form-select" id="modelSelect">
                                    {% for model in models %}
                                        <option value="{{ model }}" {% if model == current_model %}selected{% endif %}>{{ model }}</option>
                                    {% endfor %}
                                </select>
                                <button class="btn btn-primary" id="loadModelBtn">
                                    {% if current_language == 'es' %}
                                        Cargar Modelo
                                    {% else %}
                                        Load Model
                                    {% endif %}
                                </button>
                            </div>
                            <div class="mt-2" id="modelStatus">
                                {% if current_model %}
                                    <div class="alert alert-success">
                                        {% if current_language == 'es' %}
                                            Modelo cargado: {{ current_model }}
                                        {% else %}
                                            Model loaded: {{ current_model }}
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="alert alert-warning">
                                        {% if current_language == 'es' %}
                                            No hay ningún modelo cargado
                                        {% else %}
                                            No model is loaded
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <form id="predictionForm">
                            <div class="mb-3">
                                <label for="titleInput" class="form-label">
                                    {% if current_language == 'es' %}
                                        Título del Artículo
                                    {% else %}
                                        Article Title
                                    {% endif %}
                                </label>
                                <input type="text" class="form-control" id="titleInput" placeholder="{% if current_language == 'es' %}Ingrese el título del artículo médico{% else %}Enter the medical article title{% endif %}">
                            </div>
                            <div class="mb-3">
                                <label for="abstractInput" class="form-label">
                                    {% if current_language == 'es' %}
                                        Resumen del Artículo
                                    {% else %}
                                        Article Abstract
                                    {% endif %}
                                </label>
                                <textarea class="form-control" id="abstractInput" rows="6" placeholder="{% if current_language == 'es' %}Ingrese el resumen del artículo médico{% else %}Enter the medical article abstract{% endif %}"></textarea>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    {% if current_language == 'es' %}
                                        Predecir Categorías
                                    {% else %}
                                        Predict Categories
                                    {% endif %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="card result-card" id="resultCard">
                    <div class="card-header text-white">
                        <h3 class="mb-0">
                            {% if current_language == 'es' %}
                                Resultados de la Predicción
                            {% else %}
                                Prediction Results
                            {% endif %}
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h4>
                                {% if current_language == 'es' %}
                                    Categorías Predichas
                                {% else %}
                                    Predicted Categories
                                {% endif %}
                            </h4>
                            <div id="categoriesContainer" class="mt-3"></div>
                        </div>
                        
                        <div>
                            <h4>
                                {% if current_language == 'es' %}
                                    Probabilidades por Categoría
                                {% else %}
                                    Probabilities by Category
                                {% endif %}
                            </h4>
                            <div id="probabilitiesContainer" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadModelBtn = document.getElementById('loadModelBtn');
            const predictionForm = document.getElementById('predictionForm');
            const resultCard = document.getElementById('resultCard');
            const modelStatus = document.getElementById('modelStatus');
            const categoriesContainer = document.getElementById('categoriesContainer');
            const probabilitiesContainer = document.getElementById('probabilitiesContainer');
            
            // Cargar modelo
            loadModelBtn.addEventListener('click', function() {
                const modelSelect = document.getElementById('modelSelect');
                const selectedModel = modelSelect.value;
                
                if (!selectedModel) {
                    showError('{% if current_language == "es" %}Por favor seleccione un modelo{% else %}Please select a model{% endif %}');
                    return;
                }
                
                const formData = new FormData();
                formData.append('model', selectedModel);
                
                fetch('/load_model', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        modelStatus.innerHTML = `
                            <div class="alert alert-success">
                                {% if current_language == 'es' %}
                                    Modelo cargado: ${data.model}
                                {% else %}
                                    Model loaded: ${data.model}
                                {% endif %}
                            </div>
                        `;
                    } else {
                        showError(data.error);
                    }
                })
                .catch(error => {
                    showError('{% if current_language == "es" %}Error al cargar el modelo{% else %}Error loading the model{% endif %}');
                    console.error('Error:', error);
                });
            });
            
            // Realizar predicción
            predictionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('titleInput').value;
                const abstract = document.getElementById('abstractInput').value;
                
                if (!title && !abstract) {
                    showError('{% if current_language == "es" %}Por favor ingrese al menos un título o un resumen{% else %}Please enter at least a title or an abstract{% endif %}');
                    return;
                }
                
                const formData = new FormData();
                formData.append('title', title);
                formData.append('abstract', abstract);
                
                fetch('/predict', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayResults(data.categories, data.probabilities);
                    } else {
                        showError(data.error);
                    }
                })
                .catch(error => {
                    showError('{% if current_language == "es" %}Error al realizar la predicción{% else %}Error making the prediction{% endif %}');
                    console.error('Error:', error);
                });
            });
            
            // Mostrar resultados
            function displayResults(categories, probabilities) {
                // Mostrar categorías
                categoriesContainer.innerHTML = '';
                if (categories.length === 0) {
                    categoriesContainer.innerHTML = `
                        <div class="alert alert-info">
                            {% if current_language == 'es' %}
                                No se encontraron categorías para este texto
                            {% else %}
                                No categories found for this text
                            {% endif %}
                        </div>
                    `;
                } else {
                    categories.forEach(category => {
                        const badge = document.createElement('span');
                        badge.className = 'badge category-badge';
                        badge.textContent = category;
                        categoriesContainer.appendChild(badge);
                    });
                }
                
                // Mostrar probabilidades
                probabilitiesContainer.innerHTML = '';
                const sortedCategories = Object.keys(probabilities).sort((a, b) => probabilities[b] - probabilities[a]);
                
                sortedCategories.forEach(category => {
                    const probability = probabilities[category];
                    const percentage = Math.round(probability * 100);
                    
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'mb-3';
                    progressDiv.innerHTML = `
                        <div class="d-flex justify-content-between mb-1">
                            <span>${category}</span>
                            <span>${percentage}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${percentage}%" 
                                aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    `;
                    
                    probabilitiesContainer.appendChild(progressDiv);
                });
                
                // Mostrar tarjeta de resultados
                resultCard.style.display = 'block';
                resultCard.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Mostrar error
            function showError(message) {
                modelStatus.innerHTML = `
                    <div class="alert alert-danger">
                        ${message}
                    </div>
                `;
            }
        });
    </script>
</body>
</html>